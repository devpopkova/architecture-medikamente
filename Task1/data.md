# Data-Flow Analysis и аудит безопасности

> **Проект:** Medikamente • **Версия:** As-Is • **Дата:** 18 мая 2025 г.

---

## 1. Каталог конфиденциальных данных, обнаруженных в компании

| ID         | Категория                 | Атрибуты / поля                            | Где возникает                        | Кто использует        |
|------------|---------------------------|--------------------------------------------|--------------------------------------|-----------------------|
| **PD-01**  | Персональные данные       | Ф. И. О., дата рожд., пол, телефон, e-mail | Приём пациента (ресепшен, web-форма) | Все отделы            |
| **PD-02**  | Расширенные ПД            | Паспорт, адрес, место работы, СНИЛС        | Добровольная анкета                  | Ресепшен, бухгалтерия |
| **MH-01**  | Медицинская история (PHI) | Диагнозы, жалобы, назначения               | Приём врача                          | Врачи                 |
| **LAB-01** | Лабораторные результаты   | Анализы, референсные значения              | Лаборатория → клиника                | Врачи, пациент        |  
| **PAY-01** | Финансовые данные         | Сумма оплач., дата, чек#, фиск. док-ID     | Касса                                | Кассир, бухгалтерия   | 
| **EMP-01** | Данные сотрудников        | Труд. договор, зарплата, ИНН               | HR, бухгалтерия                      | Директор, бухгалтера  |
| **IMG-01** | Файлы-сканы карт          | JPG/PDF медкарт и договоров                | Файловый сервер                      | Все отделы            |

> **Неучтённые данные** — категории **MH-01**, **LAB-01**, **IMG-01** нигде формально не описаны, нет учёта владения и
> логов доступа.

## 2. Проблемы

| # | Процесс              | Угроза                                                     | Текущая мера                    | Оценка риска    | Комментарий                  |
|---|----------------------|------------------------------------------------------------|---------------------------------|-----------------|------------------------------|
| 1 | Регистрация пациента | Excel с персональными данными открывается любому сотруднику | права Windows-папки             | **Высокий**     | Нет шифрования, нет журналов |
| 2 | Ведение мед. карт    | Утечка JPG/PDF PHI                                         | Общая папка на файловом сервере | **Критический** | Нет DLP, контроля версий     |
| 3 | Лаборатория          | Результат приходит по обычной почте                        | Случайный TLS                   | **Высокий**     | Нет псевдонимизации          |
| 4 | Оплата               | Ручная правка сумм                                         | Отсутствует                     | **Средний**     | 1С заполняют пост-фактум     |
| 5 | Склад                | Общий логин 1С                                             | Пароль «sklad» у всех           | **Высокий**     | Нет RBAC и сегментации       |

## 3. Предлагаемые решения

| Категория данных                              | Основная цель                                                                   | Подход                                                    | 
|-----------------------------------------------|---------------------------------------------------------------------------------|-----------------------------------------------------------|
| **PD-01 / PD-02**<br>базовые и расширенные ПД | в продакшене всё под шифром, в тесте можно работать с копией                    | **Статическая маскировка** + шифрование                   |
| **MH-01**<br>медкарты                         | минимизировать объём PHI, доступный не-врачам                                   | **Динамическая маскировка** + ABAC                        | 
| **LAB-01**<br>лабораторные PDF                | отдаём партнёру без Ф. И. О.                                                    | **Обфускация (токенизация)**                              |
| **PAY-01**<br>чеки, суммы                     | исключить номера карт                                                           | **Детерминированная маскировка**                          |
| **IMG-01**<br>сканы паспортов/договоров       | предотвратить индексирование/просмотр(даже если файл украли, не должны прочесть) | **Недетерминированная маскировка** + шифрование хранилища |

## 4. Тегирование

| Измерение          | Тег-значение                                   | Что означает                                          | Автоматическое действие                         |
|--------------------|------------------------------------------------|-------------------------------------------------------|-------------------------------------------------|
| **Категория**      | `pii`                                          | персональные данные (Ф. И. О., паспорт, контакты)     | Шифрование диска, маскирование в dev            |
|                    | `phi`                                          | медицинская информация: диагнозы, назначения, анализы | Доступ **только** ролям `Doctor`, ведётся аудит |
|                    | `financial`                                    | суммы оплат, чеки, ФП (PAY-01)                        | Аудит бухгалтерии, детерминированная маска PAN  |
|                    | `clinical_raw`                                 | «сырые» данные лабораторий до валидации               | Хранить ≤ 30 дней, затем удалить                |
|                    | `analytics_ready`                              | агрегированные, обезличенные наборы                   | Доступ BI-сервисам без ограничений              |
| **Уровень**        | `sensitivity:low`                              | открытые сведения (ID визита)                         | –                                               |
|                    | `sensitivity:med`                              | телефон, адрес                                        | Только Trusted-Staff + маска в UI               |
|                    | `sensitivity:high`                             | паспорт, PHI                                          | АБАК: шифрование + запрет экспорта              |
| **Владелец**       | `owner:reception` / `owner:lab` …              | бизнес-подразделение («data owner»)                   | Уведомления при изменении схемы                 |
| **Срок**           | `retention:30d` / `retention:365d`             | период хранения 30 или 365 дней                       | NiFi-Job «delete-expired»                       |
| **Стадия lineage** | `stage:raw` `stage:verified` `stage:analytics` | где находится датасет в конвейере                     | виден на графе Data Lineage                     |

## 5. Маппинг тегов к методам защиты и категориям данных из проекта

| Категория данных  | Пример тегов                         | Метод защиты (авто)                                  |
|-------------------|--------------------------------------|------------------------------------------------------|
| PD-01 / PD-02     | `pii`, `sensitivity:med`             | статическая **маскировка** при копии, AES-256 в прод |
| MH-01             | `phi`, `sensitivity:high`            | динамическая маскировка + ABAC, журнал RLS           |
| LAB-01 (верифиц.) | `phi`, `stage:verified`, `owner:lab` | токенизация patient\_id перед отправкой внешним API  |
| LAB-01 (raw)      | `clinical_raw`, `retention:30d`      | авто-удаление через 30 дней                          |
| PAY-01            | `financial`, `sensitivity:med`       | детерминированная маска PAN                          |
| IMG-01            | `pii`, `phi`, `sensitivity:high`     | недетерминированная маска OCR +  файл шифруется      |


